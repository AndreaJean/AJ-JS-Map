const JM_util={uuid:function(){for(var t=[],e="0123456789abcdef",i=0;i<36;i++)t[i]=e.substr(Math.floor(16*Math.random()),1);t[14]="4",t[19]=e.substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-";var o=t.join("");return o},mergeObjectDeep:function(t,e){let i=this.deepCopy(t);for(let o in t){let n=t[o],a=e[o];this.isObjectObject(n)&&this.checkNull(a)?i[o]=this.mergeObjectDeep(n,a):this.checkNull(a)&&(i[o]=this.deepCopy(a))}return i},deepCopy:function(t){var e=null;if(this.isObjectObject(t))for(var i in e={},t)e[i]=this.deepCopy(t[i]);else{if(!this.isArray(t))return t;e=[],t.forEach(t=>{e.push(this.deepCopy(t))})}return e},getType:function(t){var e=Object.prototype.toString.call(t),i={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regExp","[object Undefined]":"undefined","[object Null]":"null","[object Object]":"object"};return t instanceof Element?"element":i[e]},isArray:function(t){return Array.isArray(t)||"[object Array]"===Object.prototype.toString.call(t)},isObject:function(t){var e=typeof t;return("function"===e||"object"===e)&&!!t},isObjectObject:function(t){return"[object Object]"===Object.prototype.toString.call(t)},isDate:function(t){return"[object Date]"===Object.prototype.toString.call(t)},isFunction:function(t){return"[object Function]"===Object.prototype.toString.call(t)},isString:function(t){return"[object String]"===Object.prototype.toString.call(t)},isNumber:function(t){return"[object Number]"===Object.prototype.toString.call(t)},checkNull:function(t){if(null===t||""===t||void 0===t)return!1;if("{}"===JSON.stringify(t)){let e=!1;for(let i in t)e=!0;return e}return!this.isString(t)&&!this.isArray(t)||0!==t.length},checkRepeat:function(t){for(let e=0;e<t.length;e++){let i=[...t],o=i[e];if(i.splice(e,1),i.includes(o))return!1}return!0},evil:function(t){let e=Function;return new e("return "+t)()}},JM_option={id:"",area:"北京",center:[116.404,39.915],zoom:12,minZoom:1,maxZoom:30,mapStyle:"normal",viewMode:"2D",resizeEnable:!0,rotateEnable:!0,pitchEnable:!0,pitch:-90,rotation:0,showBuildingBlock:!0,buildingAnimation:!0,expandZoomRange:!0,enableScrollWheelZoom:!0,enableDoubleClickZoom:!0,enableDragging:!0,enableMapClick:!1,enableHighResolution:!0,enableAutoResize:!0,icMapOnloadFunc:null,listenerFunc:function(t,e){console.log("监听类型：",t,"回传内容",e)},scaleControl:{show:!1,position:["BOTTOM","LEFT"],x:100,y:24},navigationControl:{show:!1,position:["BOTTOM","LEFT"],x:17,y:60},overviewMapControl:{show:!1,open:!1,position:["BOTTOM","RIGHT"],x:10,y:5},infoWinOption:{point:[0,0],offset:[0,33],type:"normal",width:300,title:"信息",img:"",imgSize:["100%","100px"],content:"",button:[],info:null,contentHtml:"",customClass:""},icMapContextMenu:{isUsed:!1,customClass:"",menuItem:[]},ContextMenuOption:{isUsed:!1,point:[0,0],menuItem:[],info:"",customClass:""},markerStyle:{url:"http://192.168.191.155:8989/VisualizePlatform/view/externalJs/images/marker.png",position:[19,33],anchor:[10,16],imageOffset:[0,0],imageSize:[19,33],isSymbol:!1,SymbolShapeType:"",symbolPts:[],symbolStyle:{anchor:[0,0],scale:1,rotation:0,strokeWeight:2,strokeColor:"#3D82EA",strokeOpacity:1,fillColor:"#fff",fillOpacity:.6}},labelStyle:{color:"#fff",fontSize:"12px",fontFamily:"微软雅黑",background:"rgba(45, 140, 240, .8)",width:"80px",height:"80px",padding:"20px 0",lineHeight:"22px",border:"1px solid #2d8cf0",borderRadius:"50px",transform:"translate(-50%, -50%)",textAlign:"center",boxSizing:"border-box",offset:[0,0],angle:0,enableMassClear:!0,cursor:"pointer"},circleStyle:{strokeWeight:2,strokeColor:"#3D82EA",strokeOpacity:1,strokeStyle:"solid",fillColor:"#fff",fillOpacity:.6,enableMassClear:!1},polylineStyle:{strokeWeight:4,strokeColor:"#3D82EA",strokeOpacity:1,strokeStyle:"solid",enableMassClear:!1},CurveLineStyle:{strokeWeight:4,strokeColor:"#3D82EA",strokeOpacity:1,strokeStyle:"solid",enableMassClear:!1},polygonStyle:{strokeWeight:2,strokeColor:"#3D82EA",strokeOpacity:1,strokeStyle:"solid",fillColor:"#fff",fillOpacity:.6,enableMassClear:!1},icBoundary:{isUsed:!1,area:[],polygonStyle:{strokeWeight:2,strokeColor:"#3D82EA",strokeOpacity:1,strokeStyle:"solid",fillColor:"#fff",fillOpacity:0,enableMassClear:!1},hover:{isUsed:!1,polygonStyle:{strokeWeight:2,strokeColor:"#3D82EA",strokeOpacity:1,strokeStyle:"solid",fillColor:"#fff",fillOpacity:0},func:null}},icHeatMap:{isUsed:!1,option:{radius:20,visible:!0,opacity:.6}},icCurveLine:{isUsed:!1},icCluster:{isUsed:!1,girdSize:60,maxZoom:22,minClusterSize:2,isAverangeCenter:!1,styles:[{url:"http://www.easyicon.net/api/resizeApi.php?id=501219&size=48",size:[48,48],anchor:[0,0],offset:[48,48],textSize:14,textColor:"#fff"}]},icDriving:{startIcon:{url:"http://www.easyicon.net/api/resizeApi.php?id=1061279&size=48",position:[32,32],anchor:[16,32],imageOffset:[0,0],imageSize:[32,32]},endIcon:{url:"http://www.easyicon.net/api/resizeApi.php?id=1061278&size=48",position:[32,32],anchor:[16,32],imageOffset:[0,0],imageSize:[32,32]},runIcon:{url:"http://www.easyicon.net/api/resizeApi.php?id=11019&size=48",position:[48,48],anchor:[24,48],imageOffset:[0,0],imageSize:[48,48]},runIconTitle:"",pathStyle:{strokeWeight:4,strokeColor:"#3D82EA",strokeOpacity:.6,strokeStyle:"solid"},pathHoverStyle:{strokeWeight:4,strokeColor:"#E6273E",strokeOpacity:1,strokeStyle:"solid"}},icLuShu:{isUsed:!1,icon:{url:"http://lbsyun.baidu.com/jsdemo/img/car.png",position:[52,26],imageOffset:[0,0],imageSize:[52,26]},option:{speed:4500,defaultContent:"",autoView:!0,enableRotation:!0,landmarkPois:[]}},icDistanceTool:{isUsed:!1,followText:"",unit:"metric",lineColor:"#E6273E",lineStroke:3,opacity:1,lineStyle:"solid"},icMapTypeControl:{show:!1,position:["bottom","center"],x:0,y:5,customClass:"",viewMode:["2D","3D","卫星"],button:[{viewMode:"2D",label:"二 维"},{viewMode:"卫星",label:"实 景"},{viewMode:"3D",label:"三 维"}]},icDrawControl:{isUsed:!1,show:!0,position:["top","center"],type:["marker","circle","polyline","polygon","rectangle","clear"],defaultType:"marker",x:0,y:20,customClass:"",completeFunc:{marker:null,circle:null,polyline:null,polygon:null,rectangle:null,clear:null}},icToolBar:{show:!1,customClass:"",layout:["center"],position:["right","top"],x:10,y:20},icSearchBar:{show:!1,customClass:"",keyword:"",placeholder:"请输入关键字",select:{show:!1,value:[],dataList:[],option:{label:"text"}},searchFunc:null},icCustomBox:[],icCustomBoxItem:{show:!1,customClass:"",position:["right","top"],x:10,y:0,data:[]}},JM_html={addMapDiv:function(t,e){var i=$("#"+t),o="<div class='ic-map-div'><div id='"+e+"' class='ic-map'></div></div>";i.append(o)},addMapTypeControl:function(t,e){var i="<div class='ic-map-type-control'>";e.forEach(t=>{i+="<div class='ic-map-type-control-btn'><button viewMode=\""+t.viewMode+'">'+t.label+"</button>","卫星"===t.viewMode&&(i+="<div class='ic-map-type-control-mark'><span class='ic-map-checkbox-icon'><span class='ic-map-checkbox-fill'></span></span><span class='ic-map-checkbox-label'>标注</span></div>"),i+="</div>"}),i+="</div>",t.append(i)},addToolBar:function(t,e,i){var o={center:{label:e,icon:"icon-position"},traffic:{label:"路况",icon:"icon-shishilukuang-copy"},edit:{label:"编辑",icon:"icon-bianji-copy-copy"},coordinate:{label:"拾取坐标",icon:"icon-zuobiao"},draw:{label:"绘图",icon:"icon-draw"},measure:{label:"测距",icon:"icon-juli-copy"}},n="<div class='ic-map-toolbar'>";i.forEach((t,e)=>{if(e<3){var i=o[t];n+="<span class='ic-map-toolbar-btn "+t+"'><i class='icon iconfont "+i.icon+"'></i>"+i.label+"</span><b></b>"}}),i.length>3&&(n+="<span class='ic-map-toolbar-btn boxBtn'><i class='icon iconfont icon-tool'></i>工具箱</span><div class='ic-map-toolbar-tool'><b class='ic-map-toolbar-triangle'></b>",i.forEach((t,e)=>{if(e>=3){var i=o[t];n+="<span class='ic-map-toolbar-btn "+t+"'><i class='icon iconfont "+i.icon+"'></i>"+i.label+" </span>"}}),n+="</div>"),n+="</div>",t.append(n)},addDrawBar:function(t,e){var i="<div class='ic-edit-control'>";e.forEach(t=>{i+="<button data-type='"+t+"'><i class='icon iconfont icon-map-"+t+"'></i></button>"}),i+="</div>",t.append(i)},addSearchBar:function(t){var e="";t.append(e)},addAdvancedLabel:function(t){var e="";t.append(e)}};let IcJsMap=function(){let t=this;return t.newObj={box:null,option:"",map:null,init:function(t,e){let i=JM_util.deepCopy(JM_option);this.option=JM_util.mergeObjectDeep(i,e||{}),this.option.id="map_"+JM_util.uuid(),JM_html.addMapDiv(t,this.option.id),this.box=$("#"+t+" .ic-map-div"),this.map=new JM_map,this.map.init(this.option),this.initComponents()},initComponents:function(){this.option.icMapTypeControl.show&&this.mapTypeControl.init(),this.option.icToolBar.show&&this.toolBar.init(),this.option.icDrawControl.isUsed&&this.drawBar.init(),this.option.icSearchBar.show&&this.searchBar.init()},showCustomOverlays(t,e,i,o){o||(this.setting.icCustomBox[e].data[i].active=!this.setting.icCustomBox[e].data[i].active,this.setting.icCustomBox=[...this.setting.icCustomBox]),t.active=this.setting.icCustomBox[e].data[i].active,t=this.setOverlayObjAttributes(t),this.map.showOverlays(t.data,t.overlayType,t.active)},setClusterStatus(t){this.map.setClusterStatus(t)},setOverlayObjAttributes:t=>(t.data.forEach((e,i)=>{if(e.overlayType=t.overlayType,e.infoWinStyle=t.infoWinStyle,e.contextMenu=t.contextMenu,e.dragendEvent=t.dragendEvent,e.stopDefaultClickEvent=!!t.stopDefaultClickEvent,e.clickEvent=t.clickEvent,e.dblclickEvent=t.dblclickEvent,e.mouseoverEvent=t.mouseoverEvent,e.mouseleaveEvent=t.mouseleaveEvent,"heatMap"===t.overlayType)e.max=t.max;else{let i=e.overlayType+"Style";e[i]=t[i],e.hoverStyle=t.hoverStyle,"marker"===t.overlayType&&(e.animationType=t.animationType)}if(["circle","polyline","polygon","rectangle"].includes(t.overlayType)&&(e.lng=e.center[0],e.lat=e.center[1]),"AdvancedLabel"===t.overlayType){let t=document.getElementsByName("ic-advanced-label-item")[i];e.innerHTML=t.outerHTML}}),t),setControlPosition(t){let e=t.position,i={[e[0]]:t.y+"px"};return"center"!==e[1]&&(i[e[1]]=t.x+"px"),i},$_getAllMapStyles:()=>JM_stylesB,$_getZoom(){return this.map.getZoom()},$_setMapStyle(t){this.map.setMapStyle(t)},$_onChangeMapType(t){this.mapTypeControl.changeType(t)},$_onPanTo(t){this.map.panToFunc(t)},$_onZoomTo(t){this.map.zoomToFunc(t)},$_setTrafficStatus(t){this.toolBar.setTraffic(t)},$_setEditStatus(t){this.toolBar.setEdit(t)},$_setDistanceToolStatus(t){this.toolBar.setDistance(t)},$_setDrawStatus(t){this.toolBar.setDraw(t)},$_setDrawMode(e){this.map.setDrawMode(e),t.newObj.drawBar.btns.each(function(){$(this).attr("data-type")===e&&($(this).hasClass("active")||(t.newObj.drawBar.btns.removeClass("active"),$(this).addClass("active")))})},$_setCoordinateStatus(t){this.toolBar.setCoordinate(t)},$_showOverlays(t,e){t=this.setOverlayObjAttributes(t),this.map.showOverlays(t.data,t.overlayType,e)},$_clearAllOverlays(){let t=this,e=t.option.icCustomBox;JM_util.checkNull(e)&&e.forEach((t,e)=>{t.data.forEach(t=>{t.active=!1})}),this.option.icToolBar.show&&JM_util.checkNull(this.toolBar)&&this.$_setTrafficStatus(!1),JM_util.checkNull(this.editBar)&&this.$_setEditStatus(!1),this.map.clearAllOverlays()},$_getOverlayByID(t){return this.map.getOverlayById(t)},$_setOverlayStyle(t,e){this.map.setOverlayStyle(t,e)},$_centerAndOpenInfoWindow(t,e){this.map.centerAndOpenInfoWindow(t,e)},$_getDrivingPath(t,e,i,o){this.map.getDrivingPath(t,e,0,!1,i,o)},$_getDrivingPathAndRun(t,e,i,o,n){this.map.getDrivingPath(t,e,i,!1,o,n)},$_getDrivingPathAndLuShu(t,e,i,o){this.map.getDrivingPath(t,e,!0,!0,i,o)},$_addLuShuAction(t){this.map.setLuShuAction(t)},$_clearDrivingPath(){this.map.clearDrivingPath()}},t.newObj.mapTypeControl={viewMode:"2D",control:null,buttons:null,mark:null,init:function(){JM_html.addMapTypeControl(t.newObj.box,t.newObj.option.icMapTypeControl.button),this.control=t.newObj.box.find(".ic-map-type-control"),this.buttons=t.newObj.box.find(".ic-map-type-control-btn>button"),this.mark=t.newObj.box.find(".ic-map-type-control-mark"),this.buttons.eq(0).addClass("active"),this.mark.hide(),this.bind()},bind:function(){let t=this;this.buttons.click(function(){t.buttons.removeClass("active"),$(this).addClass("active");let e=$(this).attr("viewMode");t.changeType(e)}),this.mark.click(function(){$(this).hasClass("select")?(t.changeType("卫星无路网"),$(this).removeClass("select")):($(this).addClass("select"),t.changeType("卫星"))})},changeType:function(e){this.viewMode!==e&&(t.newObj.map.setMapType(e),this.viewMode=e,["卫星","卫星无路网"].includes(e)?this.mark.addClass("select").show():this.mark.hide())}},t.newObj.toolBar={bar:null,areaBtn:null,trafficBtn:null,editBtn:null,toolBoxBtn:null,toolList:null,coordinateBtn:null,drawBtn:null,distanceBtn:null,status:{traffic:!1,edit:!1,draw:!1,distance:!1,coordinate:!1},init:function(){let e=t.newObj.option.icToolBar.layout;JM_html.addToolBar(t.newObj.box,t.newObj.option.area,e),this.bar=t.newObj.box.find(".ic-map-toolbar"),this.areaBtn=t.newObj.box.find(".ic-map-toolbar-btn.center"),this.trafficBtn=t.newObj.box.find(".ic-map-toolbar-btn.traffic"),this.editBtn=t.newObj.box.find(".ic-map-toolbar-btn.edit"),this.toolBoxBtn=t.newObj.box.find(".ic-map-toolbar-btn.boxBtn"),this.toolList=t.newObj.box.find(".ic-map-toolbar-tool"),this.coordinateBtn=t.newObj.box.find(".ic-map-toolbar-btn.coordinate"),this.drawBtn=t.newObj.box.find(".ic-map-toolbar-btn.draw"),this.distanceBtn=t.newObj.box.find(".ic-map-toolbar-btn.measure"),this.toolList.hide(),this.bind()},bind:function(){let e=this;this.areaBtn.click(function(){t.newObj.map.panToFunc(t.newObj.option.center,t.newObj.option.zoom)}),this.trafficBtn.click(function(){e.setTraffic(!e.status.traffic)}),this.editBtn.click(function(){e.setEdit(!e.status.edit)}),this.toolBoxBtn.click(function(){e.toolList.toggle()}),this.coordinateBtn.click(function(){e.setCoordinate(!e.status.coordinate)}),this.drawBtn.click(function(){e.setDraw(!e.status.draw)}),this.distanceBtn.click(function(){e.setDistance(!e.status.distance)})},setTraffic:function(e){e!==this.status.traffic&&(this.status.traffic=!this.status.traffic,this.trafficBtn&&this.trafficBtn.toggleClass("active",e),t.newObj.map.setTrafficControl(e))},setCoordinate:function(e){e!==this.status.coordinate&&(this.status.coordinate=!this.status.coordinate,this.coordinateBtn&&this.coordinateBtn.toggleClass("active",e),t.newObj.map.setCoordinateStatus(e))},setDraw:function(e){e!==this.status.draw&&(this.status.draw=!this.status.draw,this.drawBtn&&this.drawBtn.toggleClass("active",e),t.newObj.drawBar.bar.toggle(e),t.newObj.map.setDrawStatus(e))},setEdit:function(e){e!==this.status.edit&&(!e||t.newObj.map.setEditStatus(e)?(this.status.edit=!this.status.edit,this.editBtn&&this.editBtn.toggleClass("active",e),t.newObj.map.setEditStatus(e)):alert("地图上不存在可编辑的覆盖物！"))},setDistance:function(e){e!==this.status.distance&&(this.status.distance=!this.status.distance,this.distanceBtn&&this.distanceBtn.toggleClass("active",e),t.newObj.map.setDistanceToolStatus(e))}},t.newObj.drawBar={bar:null,btns:null,init:function(){JM_html.addDrawBar(t.newObj.box,t.newObj.option.icDrawControl.type),this.bar=t.newObj.box.find(".ic-edit-control"),this.btns=this.bar.find("button"),this.btns.eq(0).addClass("active"),this.bar.hide(),this.bind()},bind:function(){let e=this;this.btns.click(function(){let i=$(this).attr("data-type");"clear"!==i&&($(this).hasClass("active")||(e.btns.removeClass("active"),$(this).addClass("active"))),t.newObj.map.setDrawMode(i)})}},t.newObj.searchBar={bar:null,input:null,clearBtn:null,btns:null,init:function(){let e=t.newObj.option.icSearchBar;JM_html.addSearchBar(t.newObj.box,e),this.bar=t.newObj.box.find(".ic-map-search"),this.input=this.bar.find(".ic-map-search-input"),this.clearBtn=this.bar.find(".ic-map-search-clear"),this.btn=this.bar.find(".ic-map-search-btn"),this.bind(e)},bind:function(t){let e=this;this.clearBtn.click(function(){e.input.val("")}),this.btn.click(function(){t.searchFunc(e.input.val())})},addResult:function(){}},t.newObj};window.IcJsMap=IcJsMap;